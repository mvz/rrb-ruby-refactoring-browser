#!/usr/bin/env ruby
require 'rrb/emacs_interface'

if $0 == __FILE__ then
  if ARGV.empty? then
    print RRB::EmacsInterface::USAGE
    exit
  end
  
  begin
    interface = RRB::EmacsInterface.new( ARGV )
    if interface.enable_refactor? then
      interface.refactor
      interface.output
    else
      STDERR << "REJECTED\n"
      exit 1
    end
  rescue
    STDERR << "ERROR: exeption raised: #{$!.message}\n"
    STDERR << "stacktrace: \n"
    STDERR.puts $!.backtrace
    exit 2
  end
  
end
